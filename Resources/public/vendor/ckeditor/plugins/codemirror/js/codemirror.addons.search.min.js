(function(){function m(h,c,a){var d;return d=h.getWrapperElement().appendChild(document.createElement("div")),d.className=a?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top",d.innerHTML=c,d}CodeMirror.defineExtension("openDialog",function(h,c,a){function d(){l||(l=!0,f.parentNode.removeChild(f))}var f=m(this,h,a&&a.bottom),l=!1,j=this,g=f.getElementsByTagName("input")[0];if(g){CodeMirror.on(g,"keydown",function(b){a&&a.onKeyDown&&a.onKeyDown(b,g.value,d)||(13==
b.keyCode||27==b.keyCode)&&(CodeMirror.e_stop(b),d(),j.focus(),13==b.keyCode&&c(g.value))});if(a&&a.onKeyUp)CodeMirror.on(g,"keyup",function(b){a.onKeyUp(b,g.value,d)});a&&a.value&&(g.value=a.value);g.focus();CodeMirror.on(g,"blur",d)}else if(h=f.getElementsByTagName("button")[0])CodeMirror.on(h,"click",function(){d();j.focus()}),h.focus(),CodeMirror.on(h,"blur",d);return d});CodeMirror.defineExtension("openConfirm",function(h,c,a){function d(){l||(l=!0,f.parentNode.removeChild(f),j.focus())}var f=
m(this,h,a&&a.bottom),h=f.getElementsByTagName("button"),l=!1,j=this,g=1,b;h[0].focus();for(a=0;a<h.length;++a)b=h[a],function(a){CodeMirror.on(b,"click",function(b){CodeMirror.e_preventDefault(b);d();a&&a(j)})}(c[a]),CodeMirror.on(b,"blur",function(){--g;setTimeout(function(){0>=g&&d()},200)}),CodeMirror.on(b,"focus",function(){++g})})})();
(function(){function m(n){return"string"==typeof n?{token:function(a){if(a.match(n))return"searching";a.next();a.skipTo(n.charAt(0))||a.skipToEnd()}}:{token:function(a){if(a.match(n))return"searching";for(;!a.eol()&&!(a.next(),a.match(n,!1)););}}}function h(){this.overlay=this.posFrom=this.posTo=this.query=null}function c(a){return a.state.search||(a.state.search=new h)}function a(a,b,i){return a.getSearchCursor(b,i,"string"==typeof b&&b==b.toLowerCase())}function d(a,b,i,c){a.openDialog?a.openDialog(b,
c):c(prompt(i,""))}function f(a,b,c,g){a.openConfirm?a.openConfirm(b,g):confirm(c)&&g[0]()}function l(a){var b=a.match(/^\/(.*)\/([a-z]*)$/);return b?RegExp(b[1],-1==b[2].indexOf("i")?"":"i"):a}function j(a,b){var i=c(a);if(i.query)return g(a,b);d(a,k,"Search for:",function(c){a.operation(function(){c&&!i.query&&(i.query=l(c),a.removeOverlay(i.overlay),i.overlay=m(i.query),a.addOverlay(i.overlay),i.posFrom=i.posTo=a.getCursor(),g(a,b))})})}function g(b,g){b.operation(function(){var i=c(b),e=a(b,i.query,
g?i.posFrom:i.posTo);(e.find(g)||(e=a(b,i.query,g?CodeMirror.Pos(b.lastLine()):CodeMirror.Pos(b.firstLine(),0)),e.find(g)))&&(b.setSelection(e.from(),e.to()),b.scrollIntoView({from:e.from(),to:e.to()}),i.posFrom=e.from(),i.posTo=e.to())})}function b(a){a.operation(function(){var b=c(a);b.query&&(b.query=null,a.removeOverlay(b.overlay))})}function q(c,g){d(c,e,"Replace:",function(e){e&&(e=l(e),d(c,o,"Replace with:",function(d){if(g)c.operation(function(){for(var b,g=a(c,e);g.findNext();)"string"!=
typeof e?(b=c.getRange(g.from(),g.to()).match(e),g.replace(d.replace(/\$(\d)/,function(a,c){return b[c]}))):g.replace(d)});else{b(c);var h=a(c,e,c.getCursor()),k=function(){var b=h.from(),g;((g=h.findNext())||(h=a(c,e),(g=h.findNext())&&(!b||h.from().line!=b.line||h.from().ch!=b.ch)))&&(c.setSelection(h.from(),h.to()),c.scrollIntoView({from:h.from(),to:h.to()}),f(c,r,"Replace?",[function(){j(g)},k]))},j=function(a){h.replace("string"==typeof e?d:d.replace(/\$(\d)/,function(b,c){return a[c]}));k()};
k()}}))})}var k='Search: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',e='Replace: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',o='With: <input type="text" style="width: 10em"/>',r="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";CodeMirror.commands.find=function(a){b(a);j(a)};CodeMirror.commands.findNext=j;CodeMirror.commands.findPrev=function(a){j(a,
!0)};CodeMirror.commands.clearSearch=b;CodeMirror.commands.replace=q;CodeMirror.commands.replaceAll=function(a){q(a,!0)}})();
(function(){function m(c,a,d,f){if(this.atOccurrence=!1,this.doc=c,null==f&&"string"==typeof a&&(f=!1),d=d?c.clipPos(d):h(0,0),this.pos={from:d,to:d},"string"!=typeof a)a.global||(a=RegExp(a.source,a.ignoreCase?"ig":"g")),this.matches=function(g,b){var d,k,e,f,j;if(g){a.lastIndex=0;d=c.getLine(b.line).slice(0,b.ch);for(k=0;!(a.lastIndex=k,j=a.exec(d),!j)&&!(e=j,f=e.index,k=e.index+(e[0].length||1),k==d.length););(k=e&&e[0].length||0)||(0==f&&0==d.length?e=void 0:f!=c.getLine(b.line).length&&k++)}else a.lastIndex=
b.ch,d=c.getLine(b.line),k=(e=a.exec(d))&&e[0].length||0,f=e&&e.index,f+k==d.length||k||(k=1);if(e&&k)return{from:h(b.line,f),to:h(b.line,f+k),match:e}};else{f&&(a=a.toLowerCase());var l=f?function(a){return a.toLowerCase()}:function(a){return a},j=a.split("\n");this.matches=1==j.length?a.length?function(g,b){var d=l(c.getLine(b.line)),f=a.length,e;if(g?b.ch>=f&&-1!=(e=d.lastIndexOf(a,b.ch-f)):-1!=(e=d.indexOf(a,b.ch)))return{from:h(b.line,e),to:h(b.line,e+f)}}:function(){}:function(a,b){var d=b.line,
f=a?j.length-1:0,e=j[f],o=l(c.getLine(d)),m=a?o.indexOf(e)+e.length:o.lastIndexOf(e),n,p,i;if(!(a?m>b.ch||m!=e.length:m<b.ch||m!=o.length-e.length))for(;!(a?!d:d==c.lineCount()-1);)if(o=l(c.getLine(d+=a?-1:1)),e=j[a?--f:++f],0<f&&f<j.length-1){if(o!=e)break}else return(n=a?o.lastIndexOf(e):o.indexOf(e)+e.length,a?n!=o.length-e.length:n!=e.length)?void 0:(p=h(b.line,m),i=h(d,n),{from:a?i:p,to:a?p:i})}}}var h=CodeMirror.Pos;m.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},
find:function(c){function a(a){a=h(a,0);return d.pos={from:a,to:a},d.atOccurrence=!1,!1}for(var d=this,f=this.doc.clipPos(c?this.pos.from:this.pos.to),l;;){if(this.pos=this.matches(c,f))return this.pos.from&&this.pos.to||console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(c){if(!f.line)return a(0);f=h(f.line-1,this.doc.getLine(f.line-1).length)}else{if(l=this.doc.lineCount(),f.line==l-1)return a(l);f=h(f.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},
to:function(){if(this.atOccurrence)return this.pos.to},replace:function(c){this.atOccurrence&&(c=CodeMirror.splitLines(c),this.doc.replaceRange(c,this.pos.from,this.pos.to),this.pos.to=h(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0)))}};CodeMirror.defineExtension("getSearchCursor",function(c,a,d){return new m(this.doc,c,a,d)});CodeMirror.defineDocExtension("getSearchCursor",function(c,a,d){return new m(this,c,a,d)})})();